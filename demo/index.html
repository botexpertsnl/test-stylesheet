<script type="text/javascript">
  (function(d, t) {
    var v = d.createElement(t), s = d.getElementsByTagName(t)[0];

    v.onload = function() {
      // --- State for the dismiss button ---
      var vfChatIsOpen = false;   // updated by postMessage events
      var btn = null;             // the × element
      var dismissed = false;      // user clicked × (permanently remove)

      // Listen for Voiceflow open/close events
      window.addEventListener('message', function(e){
        var data = e.data;
        if (typeof data === 'string') { try { data = JSON.parse(data); } catch(_) {} }
        var type = data && data.type;
        if (typeof type !== 'string') return;
        if (type.indexOf('voiceflow:open') > -1) {
          vfChatIsOpen = true;
          hideBtnAnimated();
        } else if (type.indexOf('voiceflow:close') > -1) {
          vfChatIsOpen = false;
          showBtnAnimated();
        }
      }, false);

      // Load Voiceflow widget
      window.voiceflow.chat.load({
        verify: { projectID: '6883e94f436ce39aa3ab7947' },
        url: 'https://general-runtime.voiceflow.com',
        versionID: 'production',
        voice: { url: "https://runtime-api.voiceflow.com" },
        launch: { event: { type: "launch", payload: { page_url: window.location.href } } },
        assistant: { stylesheet: "https://botexpertsnl.github.io/keune-stylesheet/styles.css" }
      });

      // Inter font (optional; icon is SVG so not required)
      if (!document.getElementById('font-inter')) {
        var l = document.createElement('link');
        l.id = 'font-inter';
        l.rel = 'stylesheet';
        l.href = 'https://fonts.googleapis.com/css2?family=Inter:wght@600;700&display=swap';
        document.head.appendChild(l);
      }

      // Respect reduced motion
      (function(){
        var st = document.createElement('style');
        st.textContent = '@media (prefers-reduced-motion: reduce){#vf-close-launcher{transition:none!important}}';
        document.head.appendChild(st);
      })();

      // Helpers to show/hide with animation
      function hideBtnAnimated() {
        if (!btn || dismissed) return;
        // if it's already hidden, skip
        if (btn.style.display === 'none') return;
        btn.style.transform = 'translateY(16px)';
        btn.style.opacity = '0';
        setTimeout(function(){
          if (btn && !dismissed) btn.style.display = 'none';
        }, 280);
      }
      function showBtnAnimated() {
        if (!btn || dismissed) return;
        // only show when chat is closed
        if (vfChatIsOpen) return;
        btn.style.display = 'flex';
        btn.style.opacity = '0';
        btn.style.transform = 'translateY(12px)';
        // force reflow then animate in
        void btn.getBoundingClientRect();
        btn.style.transition = 'transform 280ms cubic-bezier(0.2,0.6,0.2,1), opacity 280ms ease';
        btn.style.opacity = '1';
        btn.style.transform = 'translateY(0)';
      }

      // Create the × after 1s
      setTimeout(function () {
        if (document.getElementById('vf-close-launcher')) return;

        btn = document.createElement('div');
        btn.id = 'vf-close-launcher';
        btn.setAttribute('aria-label', 'Hide chat launcher');
        btn.setAttribute('role', 'button');
        btn.setAttribute('tabindex', '0');

        // Circular container
        btn.style.cssText = [
          'position:fixed',
          'bottom:70px',
          'right:24px',
          'width:28px;height:28px',
          'display:flex;align-items:center;justify-content:center',
          'border-radius:9999px',
          'border:1px solid rgba(0,0,0,.18)',
          'background:#fff',
          'color:#111', // affects SVG stroke via currentColor
          'box-shadow:0 2px 8px rgba(0,0,0,.15)',
          'cursor:pointer',
          'z-index:2147483647',
          'opacity:0;transform:translateY(12px)',
          'transition: transform 280ms cubic-bezier(0.2,0.6,0.2,1), opacity 280ms ease'
        ].join(';');

        // Pixel-perfect centered SVG X
        btn.innerHTML =
          '<svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true" style="display:block;pointer-events:none">' +
            '<path d="M6 6 L18 18 M18 6 L6 18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />' +
          '</svg>';

        function dismiss() {
          dismissed = true;
          try { window.voiceflow.chat.hide(); } catch (e) {}
          btn.style.transform = 'translateY(16px)';
          btn.style.opacity = '0';
          setTimeout(function(){ btn && btn.remove(); }, 300);
        }
        btn.onclick = dismiss;
        btn.onkeydown = function(e){
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); dismiss(); }
        };

        document.body.appendChild(btn);

        // If widget already open, keep × hidden; otherwise animate in
        if (vfChatIsOpen) {
          btn.style.display = 'none';
        } else {
          void btn.getBoundingClientRect();
          btn.style.opacity = '1';
          btn.style.transform = 'translateY(0)';
        }
      }, 1000);
    };

    v.src = "https://cdn.voiceflow.com/widget-next/bundle.mjs";
    v.type = "text/javascript";
    s.parentNode.insertBefore(v, s);
  })(document, 'script');
</script>
